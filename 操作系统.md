<!-- TOC -->

- [进程和协程的区别](#进程和协程的区别)
  - [同一进程中的线程可以共享哪些数据？](#同一进程中的线程可以共享哪些数据)
  - [线程独占哪些资源？](#线程独占哪些资源)
- [进程间通信有哪些方式？](#进程间通信有哪些方式)
- [进程同步问题](#进程同步问题)
  - [临界区的概念？](#临界区的概念)
  - [同步与互斥的概念](#同步与互斥的概念)
  - [并发、并行、异步的区别？](#并发并行异步的区别)
- [什么是僵尸进程？](#什么是僵尸进程)
  - [僵尸进程的危害](#僵尸进程的危害)
- [什么是孤儿进程？](#什么是孤儿进程)
- [什么是协程？](#什么是协程)
  - [线程和协程的区别？](#线程和协程的区别)
- [什么是用户态和内核态？](#什么是用户态和内核态)
  - [为什么要分用户态和内核态？](#为什么要分用户态和内核态)
  - [如何从用户态切换到内核态](#如何从用户态切换到内核态)

<!-- /TOC -->

## 进程和协程的区别
1. 进程是操作系统进行资源分配和调度的基本单位；线程是CPU调度和分派的基本单位
2. 线程依赖进程而存在，一个进程至少有一个线程
3. 进程有自己的独立地址空间，线程共享所属进程的地址空间地址
4. 进程是拥有系统资源的一个独立单位，而线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源(如程序计数器、一组寄存器和栈)，和其他线程共享本进程的相关资源如内存、I/O、CPU等
5. 在进程切换时，涉及到整个当前进程CPU环境的保存、环境的设置以及新被调度运行的CPU环境的设置，而线程切换只需要保存和设置少量的寄存器的内容，并不涉及存储器管理方面的操作。可见，进程切换的开销远大于线程切换的开销
6. 线程之间的通信更方便，统一进程下的线程共享全局变量等数据，而进程之间的通信需要以进程间通信(IPC)的方式进行
7. 多线程程序只要有一个线程崩溃，整个程序就崩溃了；但多进程程序中一个进程崩溃并不会对其他进程造成影响，因为进程有自己的独立地址空间，因此多进程更加健壮

### 同一进程中的线程可以共享哪些数据？
<details>
<summary>同一进程中的线程可以共享哪些数据？</summary>

1. 进程代码段
2. 进程的公有数据(全局变量、静态变量...)
3. 进程打开的文件描述符
4. 进程的当前目录
5. 信号处理器/信号处理函数：对收到的信号的处理方式
6. 进程ID与进程组ID
</details>

### 线程独占哪些资源？
<details>
<summary>线程独占哪些资源？</summary>

1. 线程ID
2. 一组寄存器的值
3. 线程自身的栈(堆是共享的)
4. 错误返回码：线程可能会产生不同的错误返回码，一个线程的错误返回码不应该被其他线程修改
5. 信号掩码/信号屏蔽字(Signal mask)：表示是否屏蔽/阻塞相应的信号（SIGKILL,SIGSTOP除外）
</details>

## 进程间通信有哪些方式？
参考文章如下：<br>
[【操作系统】进程间的通信方式](https://imageslr.com/2020/02/26/ipc.html)<br>
[进程间通信IPC (InterProcess Communication)](https://www.jianshu.com/p/c1015f5ffa74)

## 进程同步问题
### 临界区的概念？
<details>
<summary>临界区的概念</summary>
各个进程中对临界资源（互斥资源/共享变量，一次只能给一个进程使用）进行操作的程序片段
</details>

### 同步与互斥的概念
<details>
<summary>同步与互斥的概念</summary>
同步：多个进程因为合作而使得进程的执行有一定的先后顺序。比如某个进程需要另一个进程提供的消息，获得消息之前进入阻塞态；<br>
互斥：多个进程在同一时刻只有一个进程能进入临界区
</details>

### 并发、并行、异步的区别？
<details>
<summary>并发、并行、异步的区别？</summary>
并发：在一个时间段中同时有多个程序在运行，但其实任一时刻，只有一个程序在cpu上运行，宏观上的并发是通过不断的切换实现的；<br>
并行：在多CPU系统中，多个程序无论宏观还是微观上都是同时执行的;<br>
异步：同步是顺序执行，异步是在等待某个资源的时候继续做自己的事情
</details>

## 什么是僵尸进程？
一个子进程结束后，它的父进程并没有等待它(调用wait或者waitpid)，那么这个子进程将成为一个僵尸进程。<br>
僵尸进程是一个已经死亡的进程，但是没有真正被销毁。它已经放弃了几乎所有内存空间，没有任何可执行代码，也不能被调度，仅仅在进程表中保留一个位置，记载该进程的进程ID、终止状态一级资源利用信息(cpu时间、内存使用量等等)供父进程收集，除此之外，僵尸进程不再占用任何内存空间。这个僵尸进程可能会一直留在系统中知道系统重启。

### 僵尸进程的危害
<details>
<summary>僵尸进程的危害</summary>

1. 占用进程号，系统所能使用的进程号是有限的
2. 占用内存
</details>

## 什么是孤儿进程？
一个父进程已经结束了，但是它的子进程还在运行，那么这些子进程将成为孤儿进程。孤儿进程会被Init(进程ID为1)接管，当这些孤儿进程结束时由Init完成状态收集

## 什么是协程？
协程是一种用户态的轻量级线程，协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁访问全局变量，所以上下文的切换非常快

### 线程和协程的区别？
<details>
<summary>线程和协程的区别</summary>

1. 一个线程可以拥有多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核cpu
2. 线程进程都是同步机制，而协程则是异步
3. 协程能保留上一次调用时的状态，每次协程重入时，就相当于进入上一次调用的状态
</details>

## 什么是用户态和内核态？
为了限制不同程序的访问能力，防止一些程序访问其他程序的内存数据，CPU划分了用户态和内核态两个权限等级。
* 用户态只能受限的访问内存，且不允许访问外围设备，没有占用CPU的能力，CPU资源可以被其他程序获取
* 内核态可以访问内存所有数据以及外围设备，也可以进行程序切换
所有用户程序都运行在用户态，但有时需要进行一些内核态的操作，比如从硬盘或键盘读取数据，这时就需要进程系统调用，使用陷阱指令，CPU切换到内核态，执行相应的服务，再切换到用户态并返回系统调用的结果。

### 为什么要分用户态和内核态？
<details>
<summary>为什么要分用户态和内核态？</summary>

* 安全性：防止用户程序恶意或者不小心破坏系统、内存、硬件资源
* 封装性：用户程序不需要实现更加底层的代码
* 利用调度：如果多个用户程序都在等待键盘输入，这时就需要进行调度；统一交给操作系统调度更加方便
</details>

### 如何从用户态切换到内核态
<details>
<summary>如何从用户态切换到内核态</summary>

* 系统调用：比如读取命令行输入。本质上还是通过中断实现的
* 用户程序发生异常时：比如缺页异常
* 外围设备的中断：外围设备完成用户请求操作后，会想CPU发出中断信号，这时CPU会转去处理对应的中断处理程序
</details>

