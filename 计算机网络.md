<!-- TOC -->

- [计算机网络结构体现](#计算机网络结构体现)
  - [四层网络](#四层网络)
  - [七层网络](#七层网络)
  - [常见协议](#常见协议)
  - [路由器、交换机位于那一层？](#路由器交换机位于那一层)
- [传输层](#传输层)
  - [什么是三次握手](#什么是三次握手)
    - [TCP建立连接为什么不能是两次握手？](#tcp建立连接为什么不能是两次握手)
  - [什么是四次挥手](#什么是四次挥手)
    - [TCP断开连接为什么需要四次挥手？](#tcp断开连接为什么需要四次挥手)
    - [主动方进入TIME_WAIT状态的意义是什么？](#主动方进入time_wait状态的意义是什么)
  - [TCP和UDP的区别](#tcp和udp的区别)
    - [面向字节流和面向报文的区别](#面向字节流和面向报文的区别)
    - [什么时候选择TCP，什么时候选择UDP](#什么时候选择tcp什么时候选择udp)
    - [HTTP可以使用UDP吗？](#http可以使用udp吗)
  - [TCP如何保证传输的可靠性](#tcp如何保证传输的可靠性)
- [应用层](#应用层)
  - [http和https有什么区别](#http和https有什么区别)
    - [你访问的网站是如何自动切换到https的？](#你访问的网站是如何自动切换到https的)
  - [POST和GET的区别](#post和get的区别)
  - [从输入网址到获得页面的全过程](#从输入网址到获得页面的全过程)
    - [概述](#概述)
    - [详细](#详细)
  - [HTTP请求状态码](#http请求状态码)
    - [什么时候会产生304状态码？](#什么时候会产生304状态码)
  - [cookie和session的区别](#cookie和session的区别)
  - [什么是RIP(距离矢量路由协议)？](#什么是rip距离矢量路由协议)
    - [RIP协议优缺点](#rip协议优缺点)
- [网络层](#网络层)
  - [什么是ARP协议？](#什么是arp协议)
  - [什么是NAT(网络地址转换)？](#什么是nat网络地址转换)

<!-- /TOC -->
# 计算机网络结构体现
## 四层网络
数据链路层，网络层，传输层，应用层
## 七层网络
物理层，数据链路层，网络层，传输层，会话层，表示层，应用层
## 常见协议
1. 应用层：FTP(21端口，文件传输协议)、SSH(22端口，远程登录)、TELNET(23端口，远程登录)、SMTP(25端口，发送邮件)、POP3(110端口，接收邮件)、HTTP(80端口，超文本传输协议)、DNS(53端口，域名解析服务)
2. 传输层: TCP/IP
3. 网络层：IP、ARP、NAT、RIP

## 路由器、交换机位于那一层？
1. 路由器网络层，根据IP地址进行寻址
2. 交换机数据链路层，根据MAC地址进行寻址

# 传输层
## 什么是三次握手
1. 客户端发送syn=1，seq=x的包给服务端
2. 服务端返回syn=1，ack=x+1，seq=y的包给客户端
3. 客户端返回ack=y+1，seq=z的包给服务端

### TCP建立连接为什么不能是两次握手？
<details>
<summary>TCP建立连接为什么不能是两次握手</summary>

1. 为了防止已失效的连接请求报文突然又传送到服务端
2. 如果是两次握手，至多只有客户端的起始序列号能被确认，服务器端的序列号则得不到确认
</details>

## 什么是四次挥手
1. 发起方向被动方发送fin、ack、seq请求关闭连接， 发起方进入FIN_WAIT_1状态
2. 被动方向发起方发送ack、seq表示同意关闭请求，发起方进入FIN_WAIT_2状态
3. 被动方向发起方发送fin、ack、seq，请求关闭连接，被动方进入LAST_ACK状态
4. 发起方向被动方发送ack、seq，然后进入TIME_WAIT状态，被动方收到发起方的报文段直接关闭连接，发起方在一段时间后未收到回复关闭连接

### TCP断开连接为什么需要四次挥手？
<details>
<summary>为什么需要四次？</summary>
当被动方收到主动方的FIN数据包之后，被动方可能还存在数据没有发送完，因此会将ACK发送给主动方表示我已经收到你的断开请求，等到数据包发送完之后再向主动方发送FIN
</details>

### 主动方进入TIME_WAIT状态的意义是什么？
<details>
<summary>主动方进入TIME_WAIT状态的意义是什么</summary>
主动方进入TIME_WAIT会等待2MSL，主动方发送给被动方的ACK有可能丢失，如果被动方没有收到ACK，会重新发送FIN，如果主动方在2MSL时间内收到了FIN，就会重新发送ACK给被动方并在此等待2MSL，防止被动方没有收到ACK而不断的发送FIN
</details>

## TCP和UDP的区别
1. TCP是面向连接的，UDP是面向无连接的
2. TCP是可靠的，UDP是不可靠的
3. TCP是面向字节流的，UDP是面向报文的
4. TCP只支持点对点通信，UDP支持一对一、一对多、多对一、多对多
5. TCP首部开销(20字节)比UDP首部开销(8字节)要大
6. TCP有拥塞控制机制，UDP没有
7. UDP的主机不需要维持复杂的连接状态表

### 面向字节流和面向报文的区别
<details>
<summary>面向字节流和面向报文的区别</summary>
面向字节流是指发送数据时以字节为单位，一个数据包可以拆分成若干组发送，而UDP一个报文只能一次发完
</details>

### 什么时候选择TCP，什么时候选择UDP
<details>
<summary>什么时候选择TCP，什么时候选择UDP</summary>

1. 对某些实时性要求比较高的情况选择UDP，比如游戏，通信媒体，直播，即使出现传输错误也可以容忍
2. 其他大部分情况，因为要求传输内容的可靠，不出现丢失，都会选择TCP
</details>

### HTTP可以使用UDP吗？
<details>
<summary>HTTP可以使用UDP吗</summary>
HTTP需要基于可靠的传输协议，因此不能使用UDP<br>
注：http3.0使用UDP实现：https://zh.wikipedia.org/wiki/HTTP/3
</details>

## TCP如何保证传输的可靠性
1. 数据包校验
2. 对失序数据包重新排序(TCP报文具有序列号)
3. 丢弃重复数据
4. 应答机制：接收方收到数据库，会发送一个确认
5. 超市重发：发送方发出数据后，启动一个定时器，超过未收到接收方的确认，则重新发送数据
6. 流量控制：确保接收端能够接收发送方的数据而不会缓冲区溢出

# 应用层
## http和https有什么区别
1. 端口不同，http默认使用80端口，http默认使用443端口
2. http信息是明文传输的，https运行在ssl之上，添加了加密和认证机制，更加安全
3. https由于加密解密会带来更大的cpu和内存开销
4. https通信需要证书，一般需要向证书颁发机构(CA)够买

### 你访问的网站是如何自动切换到https的？
<details>
<summary>你访问的网站是如何自动切换到https的</summary>

1. 一种是原始的302跳转，服务器把所有的http流量跳转到https。但这样有一个漏洞，就是中间人可能在第一次访问站点的时候就劫持
2. 引入HSTS机制，用户浏览器在访问站定的时候强制使用https

参考文章：[你访问的网站是如何自动切换到HTTPS的](https://www.sohu.com/a/136637876_487516)
</details>

## POST和GET的区别
1. GET是幂等的，即读取同一个资源，总是得到相同的数据，POST不是幂等的
2. GET一般用于从服务器获取一个资源，而POST有可能改变服务器上的资源
3. 请求形式上：GET请求的数据附在URL之后，在HTTP请求头中；POST请求的数据在请求体中
4. 安全性：GET请求可能被缓存、收藏、保留到历史记录，且其请求数据明文出现在URL中；POST的参数不会被保存，安全性相对较高
5. GET只允许ASCII字符，POST对数据类型没有要求，也允许二进制数据
6. GET的长度有限制（操作系统或浏览器），而POST数据大小无限制

## 从输入网址到获得页面的全过程
### 概述
DNS解析 -> tcp连接 -> 发送HTTP请求 -> 服务器处理请求并返回HTTP报文 -> 浏览器解析渲染页面 -> tcp断连
### 详细
1. 浏览器查询DNS，获取域名对应的IP地址
   1. 浏览器检查自身的DNS缓存(chrome缓存1分钟，大概有1000条缓存)
   2. 接下来去查看系统的hosts文件是否有域名对应的IP地址
   3. 浏览器发起DNS调用，请求运营商的DNS服务器获取域名对应的IP地址(通过UDP协议，向DNS的53端口发起请求)
   4. 运营商DNS服务器向根域名服务器请求，根域名服务器返回定义域名服务器地址
   5. 运营商DNS服务器向定于域名服务器请求得到权威域名服务器地址
   6. 运营商DNS服务器向权威域名服务器请求得到域名的主机记录，存入自身缓存并返回给客户端
2. [TCP三次握手](#什么是三次握手)
3. TCP连接建立后浏览器向服务器发送HTTP请求
4. 服务器接受到请求后，根据路径参数映射到特定的请求处理器进行处理，并将处理结果及相应的视图返回给浏览器
5. 浏览器解析并渲染视图，若遇到js文件、css文件及图片等静态资源的引用，则重复上述步骤并向服务器请求这些资源
6. 浏览器根据请求得到的资源、数据渲染页面，最终向用户呈现一个完整的页面
7. [TCP四次挥手](#什么是四次挥手)

## HTTP请求状态码
| 状态码 | 含义 |
| ---- | ---- |
| 200 | 请求成功 |
| 201 | 创建成功 |
| 204 | 没有body |
| 206 | 断点续传 |
| 301 | 重定向，修改uri |
| 302 | 重定向，不修改uri |
| 304 | 请求资源未修改，使用缓存访问资源 |
| 400 | 客户端请求语法错误，服务器无法理解 |
| 401 | 请求要被用户的身份认证 |
| 403 | 请求被拒绝（权限不够） |
| 404 | 资源未找到 |
| 501 | 服务器不支持其你去的功能，无法完成请求 |
| 502 | 请求收到无效响应 | 
| 504 | 请求超时 |

### 什么时候会产生304状态码？

## cookie和session的区别
1. session是服务器端保持状态的方案，cookie是客户端保持状态的方案
2. cookie保存在客户端本地，客户端请求服务器时会将cookie一起提交
3. session保存在服务端，通过检索session id查看状态
4. 保存session id的方式可以采用cookie，如果禁用了cookie，可以使用URL重写机制(把会话ID保存在URL中)

## 什么是RIP(距离矢量路由协议)？
每个路由器维护一张表，记录该路由器到其它网络的”跳数“，路由器到与其直接连接的网络的跳数是1，每多经过一个路由器跳数就加1；更新该表时和相邻路由器交换路由信息；路由器允许一个路径最多包含15个路由器，如果跳数为16，则不可达。交付数据报时优先选取距离最短的路径。

### RIP协议优缺点
1. 实现简单，开销小
2. 随着网络规模的扩大开销增大
3. 最大距离为15，限制了网络的规模
4. 当网络出现故障时，要经过较长的时间才能将此信息传递到所有路由器

# 网络层
## 什么是ARP协议？
ARP协议完成了IP地址与物理地址的映射。每一个主机都设有一个 ARP 高速缓存，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。当源主机要发送数据包到目的主机时，会先检查自己的ARP高速缓存中有没有目的主机的MAC地址，如果有，就直接将数据包发到这个MAC地址，如果没有，就向所在的局域网发起一个ARP请求的广播包（在发送自己的 ARP 请求时，同时会带上自己的 IP 地址到硬件地址的映射），收到请求的主机检查自己的IP地址和目的主机的IP地址是否一致，如果一致，则先保存源主机的映射到自己的ARP缓存，然后给源主机发送一个ARP响应数据包。源主机收到响应数据包之后，先添加目的主机的IP地址与MAC地址的映射，再进行数据传送。如果源主机一直没有收到响应，表示ARP查询失败。

如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。

## 什么是NAT(网络地址转换)？
用于解决内网中的主机要和因特网上的主机通信。由NAT路由器将主机的本地IP地址转换为全球IP地址，分为静态转换（转换得到的全球IP地址固定不变）和动态NAT转换

